<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" name="save" content="history">
    <title>展会信息</title>
    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/colResizable.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/jPaginate.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/bootstrap-select.css') }}" rel="stylesheet">

    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.paginate.js') }}"></script>
    <script src="{{ url_for('static', filename='js/colResizable-1.5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap-select.js') }}"></script>

    <style>


        #tickets .datagrid-sort {
            display: inline;
            padding: 0 13px 0 0;
            background: url('../static/img/datagrid_icons.png') no-repeat -64px center;
        }

        #tickets .datagrid-sort-desc {
            display: inline;
            padding: 0 13px 0 0;
            background: url('../static/img/datagrid_icons.png') no-repeat -16px center;
        }

        #tickets .datagrid-sort-asc {
            display: inline;
            padding: 0 13px 0 0;
            background: url('../static/img/datagrid_icons.png') no-repeat 0px center;
        }

        #tickets td {
            font-size: 1em;
            text-align: left;
            border: 1px solid #98bf21;
            padding: 3px 7px 2px 7px;
        }

        #tickets input {
            border: 0;
            background: transparent;
            width: 100%;
        }

        .red {
            color: red;
        }

        .top {
            background: #CCCCCC;
            cursor: pointer;
        }

        .tr_select {
            font-size: 120%;
            color: red;
        }
    </style>

</head>

<body>
<h1><a href="/" style="text-align:center; ">车票信息</a></h1>
<script type=text/javascript>
    $(function () {
        //页面加载时调用show()获取数据，此时搜索关键字全为空，所以后台返回全部数据
        show();

        function show(page) {
            $.ajax({
                type: 'GET',
                url: '/getargs',
                data: {
                    Page: page,
                    SearchInfo: $("#search_info").val,
                    SortInfo: $("#sort_info").val(),
                    UpdateInfo: $("#update_info").val(),
                    DelInfo: $("#del_info").val(),
                    AddInfo: $("#add_info").val()
                },
                success: function (data) {
                    tickets = data.result.splice(1);     //result的第一项是页数信息，从第二项开始才是ticket数据
                    pagination = data.result[0];
                    total_num = pagination.total_num;
                    num = pagination.num;
                    total_pages = pagination.total_pages;
                    current_page = pagination.current_page;

                    $("#current_page").val(current_page);
                    var $table = $('#ticket-info');
                    $table.empty();
                    createTable(tickets);    //创建表格
                    createPage(total_pages, current_page);  //创建分页
                    showNum(total_num, num);
                    showColumn();
                },
                error: function () {
                    alert('error');
                }
            });
        }

        //显示数据总条数和符合查询条件的条数
        function showNum(totalNum, num) {
            $("#showNum").html('总数量' + totalNum + ',符合查询条件的数量' + num);
        }

        //创建分页
        function createPage(count, index) {
            $("[id*='paginate']").paginate({
                count: count,
                start: index,
                display: 9,
                border: true,
                border_color: '#fff',
                text_color: '#fff',
                background_color: 'black',
                border_hover_color: '#ccc',
                text_hover_color: '#000',
                background_hover_color: '#fff',
                images: false,
                mouse: 'press',
                onChange: function (page) {
                    //$('._current', '#paginationdemo').removeClass('_current').hide();
                    //$('#p' + page).addClass('_current').show();
                    show(page);
                }
            });
        }

        //创建表格
        function createTable(data) {
            for (i in data) {
                //for (var i=1;i<data.length;i++)
                $('#ticket-info').append(
                    "<tr>" +
                    "<td><span><input type='checkbox' name='select' id='select' value=" + data[i].ID + "></span></td>" +
                    "<td>" + i + "</td>" +
                    "<input type='hidden' name='id' value=" + data[i].ticket_id + ">" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&ticket_id" + " value=" + data[i].ticket_id + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&tel_phone" + " value=" + data[i].tel_phone + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&idcard_num" + " value='" + data[i].idcard_num + "'>" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&ticket_date" + " value=" + data[i].ticket_date + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&start_from" + " value='" + data[i].start_from + "'>" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&end_to" + " value='" + data[i].end_to + "'>" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&train_number" + " value=" + data[i].train_number + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&passengers" + " value=" + data[i].passengers + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&passenger_num" + " value=" + data[i].passenger_num + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&success_rate" + " value=" + data[i].success_rate + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&price" + " value=" + data[i].price + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&status" + " value=" + data[i].status + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&create_date" + " value=" + data[i].create_date + ">" + "</td>" +
                    "<td>" + "<input " + "id=" + data[i].ticket_id + "&update_date" + " value=" + data[i].update_date + ">" + "</td>" +
                    "<td><a href='#' id=" + data[i].ticket_id + ">" + 'del' + "</a></td>" +
                    "</tr>");
            }
        }

        //根据hidden_column输入框的值显示或隐藏列
        function showColumn() {
            var column = $("#hidden_column").val();
            if (column != '') {
                select_column = column.toString().split(',');
                //alert(select_column);
                $('table tr').find("th").show();
                $('table tr').find("td").show();
                $.each(select_column, function (n, value) {
                    $('table tr').find("th:eq(" + value + ")").hide();
                    $('table tr').find("td:eq(" + value + ")").hide();
                });
            }
        }
    })
</script>

<form name="myForm" action="" method="POST">
    订单序号:<input width="20px" name="ticket_id" id="ticket_id">
    电话:<input name='tem_phone' id="tem_phone">
    身份证:<input name='idcard_num' id='idcard_num'>

    <input type='hidden' id="del_info" value="none">
    <input type='hidden' id="sort_info" value="none">
    <input type='hidden' id="update_info" value="none">
    <input type='hidden' id="search_info" value="none">
    <input type='hidden' id="add_info" value="none">
    <input type='hidden' id="current_page" value="none">
    <input id="hidden_column" value="" type='hidden'><br>
    <button id="search" type='button' style="font-size:16px;">查找</button><br>
    <b id="showNum"></b><br>

    <!--分页-->
    <div id="paginationdemo" class="paginate">
        <div id="paginate"></div>
    </div>

    <table id="tickets" width="100%" border="0" cellpadding="0" cellspacing="0">

        <thead>
        <tr class="top">
            <th width="40px">选择</th>
            <th width="40px">序号</th>
            <th width="80px">
                <a href="#" id="ticket_id" name="ticket_id" sort="">火车票序号</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="40px">
                <a href="#" id="tem_phone" name="tem_phone" sort="">电话</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" name="idcard_num" sort="">身份证</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="60px">
                <a href="#" sort="" name="ticket_date">乘车日期</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="start_from">出发地</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="60px">
                <a href="#" id='end_to' name="end_to" sort="">终点</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" id="train_number" name="train_number" sort="">火车编号</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="passengers">乘客信息</a>
                <span class="datagrid-sort"></span>
            </th>
            <!--<th><li><a href="#">产业</a></li></th>-->
            <!--<th ><li><a href="#">主办商</a></li></th>-->
            <th width="80px">
                <a href="#" sort="" name="passenger_num">乘客人数</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="success_rate">成功率</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="price">价钱</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="status">状态</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="create_date">添加日期</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="80px">
                <a href="#" sort="" name="update_date">更新日期</a>
                <span class="datagrid-sort"></span>
            </th>
            <th width="40px">操作</th>
        </tr>
        </thead>

        <tbody id="ticket-info">
        <!--表格内容由createTable()动态生成-->
        </tbody>
    </table>
    <button id="addRow" type="button" style="font-size:16px;">添加一行</button>
    <button id="mutiple_del" type='button' style="font-size:16px;">删除</button>
</form>
</body>
</html>